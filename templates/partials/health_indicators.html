{% set tips = {
    "D/E Ratio": "Debt-to-Equity ratio. Below 1.0 is conservative; above 2.0 may signal high leverage risk.",
    "ROE": "Return on Equity. Measures profitability vs shareholder equity. Above 15% is generally strong.",
    "Current Ratio": "Current assets / current liabilities. Above 1.5 is healthy; below 1.0 may signal liquidity issues.",
    "Quick Ratio": "Like Current Ratio but excludes inventory. Above 1.0 means the company can cover short-term debts.",
    "Short Float": "% of shares sold short. Above 10% suggests bearish sentiment; above 20% is very high."
} %}
<div class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
    <div class="bg-brand text-white px-5 py-3">
        <h2 class="font-bold text-sm uppercase tracking-wide">Financial Health Indicators</h2>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-3 p-4">
        {% for ind in health.indicators %}
        <div class="{{ ind.color }} text-white rounded-lg p-3 text-center shadow relative">
            <p class="text-xs font-bold uppercase tracking-wide opacity-90 {{ 'cursor-help' if tips.get(ind.label) }}" {% if tips.get(ind.label) %}title="{{ tips[ind.label] }}"{% endif %}>{{ ind.label }}</p>
            <p class="text-xl font-bold mt-1">{{ ind.value }}</p>
            {% if ind.signal %}
            <span class="inline-block mt-1 text-[10px] font-bold uppercase px-2 py-0.5 rounded-full
                {% if ind.signal == 'Good' %}bg-white/25
                {% elif ind.signal == 'Caution' %}bg-white/30
                {% else %}bg-white/20{% endif %}">
                {{ ind.signal }}
            </span>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% if health.ownership %}
    <div class="bg-brand-light dark:bg-brand/20 px-5 py-2 text-sm text-brand dark:text-blue-300 italic">
        {{ health.ownership | join(' &nbsp;|&nbsp; ') }}
    </div>
    {% endif %}
    {% if fiftyTwoWeekHigh and fiftyTwoWeekLow and current_price %}
    {% set range_span = fiftyTwoWeekHigh - fiftyTwoWeekLow %}
    {% set position_pct = ((current_price - fiftyTwoWeekLow) / range_span * 100) if range_span > 0 else 50 %}
    {% set clamped_pct = [0, [position_pct, 100] | min] | max %}
    <div class="px-5 py-3 border-t border-gray-100 dark:border-gray-700">
        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">52-Week Range</p>
        <div class="flex items-center gap-3">
            <span class="text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">${{ '%.2f' | format(fiftyTwoWeekLow) }}</span>
            <div class="relative flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-visible">
                <div class="absolute inset-0 rounded-full" style="background: linear-gradient(to right, #22c55e, #eab308, #ef4444);opacity:0.25"></div>
                <div class="absolute top-1/2 -translate-y-1/2 w-3.5 h-3.5 rounded-full border-2 border-white dark:border-gray-800 shadow-md
                    {% if clamped_pct <= 33 %}bg-green-500{% elif clamped_pct <= 66 %}bg-yellow-500{% else %}bg-red-500{% endif %}"
                     style="left: {{ clamped_pct }}%; transform: translate(-50%, -50%)"
                     title="Current: ${{ '%.2f' | format(current_price) }}"></div>
                <div class="absolute -top-5 text-[10px] font-bold
                    {% if clamped_pct <= 33 %}text-green-600 dark:text-green-400{% elif clamped_pct <= 66 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}"
                     style="left: {{ clamped_pct }}%; transform: translateX(-50%)">${{ '%.2f' | format(current_price) }}</div>
            </div>
            <span class="text-xs font-medium text-gray-500 dark:text-gray-400 whitespace-nowrap">${{ '%.2f' | format(fiftyTwoWeekHigh) }}</span>
        </div>
    </div>
    {% endif %}
</div>

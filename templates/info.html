{% extends "base.html" %}

{% block title %}Info &amp; Glossary - MarketMosaic{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-brand dark:text-blue-300 mb-6">Information &amp; Glossary</h1>

    <!-- How to Use -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">How to Use</h2>
        </div>
        <div class="px-5 py-4 space-y-3 text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
            <p><strong>Search:</strong> From the home page, type a company name (e.g. "Apple") or stock ticker (e.g. "AAPL") and click Analyze. If multiple matches are found, select the correct one.</p>
            <p><strong>Dashboard:</strong> View a full financial breakdown including KPIs, revenue trends, analyst targets, AI-generated outlook, financial health indicators, news, and peer comparison.</p>
            <p><strong>Excel Download:</strong> Click "Download Excel Report" at the bottom of any dashboard to get a styled spreadsheet with all sections.</p>
            <p><strong>Stock Tracker:</strong> Add tickers to your personal watchlist, set price alerts, and refresh quotes. Your watchlist is stored in your browser (localStorage) and persists across sessions.</p>
        </div>
    </section>

    <!-- Understanding Portfolio Analysis -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">Understanding Portfolio Analysis</h2>
        </div>
        <div class="px-5 py-4 space-y-3 text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
            <p><strong>Upload:</strong> Export your positions CSV from your brokerage (Fidelity, Schwab, Vanguard, E*Trade, and others are supported). Account numbers and sensitive fields are automatically stripped in your browser before upload.</p>
            <p><strong>Sector Allocation:</strong> Shows your portfolio broken down by sector. ETFs and mutual funds are analyzed using look-through analysis, distributing their value across underlying sectors.</p>
            <p><strong>Concentration Alerts:</strong> Any single holding exceeding 15% of your portfolio is flagged as a potential concentration risk.</p>
            <p><strong>Diversification Gaps:</strong> Industries tracked by our analyst picks database that have zero direct exposure in your portfolio, with top analyst-rated picks for each gap.</p>
            <p><strong>Analyst Consensus Overview:</strong> Aggregates Buy/Hold/Sell ratings and implied upside across all your covered holdings. Sortable by symbol, upside, rating, and more.</p>
            <p><strong>Insight Widgets:</strong> After the initial analysis loads, additional widgets load in the background &mdash; sector momentum heatmap, news digest for your top holdings, AI-generated portfolio commentary, and peer valuation comparisons.</p>
        </div>
    </section>

    <!-- Portfolio Terms & Concepts -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">Portfolio Terms &amp; Concepts</h2>
        </div>
        <div class="px-5 py-4">
            <dl class="space-y-4 text-sm">
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Look-Through Analysis</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">When your portfolio contains ETFs or mutual funds, the analyzer breaks them down into their underlying sector exposures. For example, if you hold SPY, its value is distributed across Technology, Healthcare, Financials, etc. based on the fund's actual allocation rather than counting as a single holding.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Concentration Alert (>15%)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Any single holding that exceeds 15% of your total portfolio value is flagged. High concentration in one stock increases risk — if that company underperforms, a large portion of your portfolio is affected.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Weighted Upside / Implied Upside</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">The percentage difference between a stock's current price and the analyst consensus target price. "Weighted upside" in your portfolio overview weighs each holding's upside by its share of the portfolio, giving a single upside figure for the whole portfolio.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Analyst Ratings</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Wall Street analyst consensus ratings displayed as colored badges: <strong class="text-green-700 dark:text-green-400">Strong Buy / Buy</strong> (green), <strong class="text-yellow-700 dark:text-yellow-400">Hold</strong> (yellow), <strong class="text-red-700 dark:text-red-400">Sell / Strong Sell</strong> (red). These represent the average recommendation across all covering analysts. "Low Coverage" means fewer than 3 analysts cover the stock, making the consensus less reliable.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Diversification Gaps</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Industries where your portfolio has zero direct exposure. For each gap, the top analyst-rated stocks in that industry are shown with their recommendation badge and implied upside percentage, so you can identify opportunities to broaden your portfolio.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Period Return</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">The percentage gain or loss of your portfolio over a selected time period (1 day, 1 month, 3 months, 6 months, or 1 year). Calculated by comparing the weighted performance of your holdings over that period based on their current portfolio weights.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Sector Momentum</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">A heatmap showing recent price momentum for sectors in your portfolio. Green cells indicate positive momentum (prices trending up); red cells indicate negative momentum. Helps you see which parts of your portfolio are in favor with the market.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Compound Growth Projection</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Projects your portfolio's future value using compound interest. You can adjust your current age, target age, and annual return rate. The default 10% rate reflects the S&amp;P 500 historical average since 1926 (nominal, before inflation). The "growth multiple" shows how many times your money would grow (e.g. 5x means $100K becomes $500K). Milestone badges show when you'd hit 2x, 3x, 5x, and 10x your current value.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">ESG Risk Score</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Environmental, Social, and Governance risk rating from Sustainalytics (via Yahoo Finance). Unlike most ratings, <strong>lower scores are better</strong> — they indicate less unmanaged ESG risk. The scale: <strong class="text-green-700 dark:text-green-400">0-10 Negligible</strong>, <strong class="text-green-700 dark:text-green-400">10-20 Low</strong>, <strong class="text-yellow-700 dark:text-yellow-400">20-30 Medium</strong>, <strong class="text-orange-700 dark:text-orange-400">30-40 High</strong>, <strong class="text-red-700 dark:text-red-400">40+ Severe</strong>.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">ESG Components (E / S / G)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4"><strong>Environment:</strong> carbon emissions, resource use, waste, pollution risk. <strong>Social:</strong> labor practices, product safety, data privacy, community impact. <strong>Governance:</strong> board structure, executive pay, business ethics, anti-corruption. Each component is scored separately and contributes to the overall ESG risk score.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Controversy Level</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">A 1-5 scale measuring a company's involvement in ESG-related controversies (e.g. lawsuits, regulatory actions, scandals). Level 1-2 is low concern; Level 4-5 indicates significant or severe controversies that may pose reputational and financial risk.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Controversial Product Exposure</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Flags holdings involved in categories like alcohol, gambling, tobacco, weapons, nuclear power, or thermal coal. Shows the dollar amount and percentage of your portfolio exposed to each category.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Peer Valuation</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Compares each of your holdings against its industry peers on valuation metrics (P/E ratio, margins, growth). Helps identify if your stocks are trading at a premium or discount relative to competitors.</dd>
                </div>
            </dl>
        </div>
    </section>

    <!-- Understanding the Dashboard -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">Understanding the Dashboard</h2>
        </div>
        <div class="px-5 py-4 space-y-3 text-gray-700 dark:text-gray-300 text-sm leading-relaxed">
            <p><strong>KPI Boxes:</strong> Five key metrics at a glance — market cap, current stock price, trailing P/E ratio, gross margin, and 1-year price change.</p>
            <p><strong>Revenue Trend:</strong> The last four quarters of revenue in chronological order, with quarter-over-quarter percentage changes. Green indicates growth; red indicates decline.</p>
            <p><strong>Analyst Targets:</strong> Wall Street consensus price targets (low, mean, high) plus the analyst recommendation and implied upside/downside from the current price.</p>
            <p><strong>Outlook:</strong> AI-generated commentary summarizing the company's financial health, price outlook, risks, recent news impact, and industry context. Falls back to rule-based analysis if the AI service is unavailable.</p>
            <p><strong>Health Indicators:</strong> Key financial ratios — debt-to-equity, return on equity, current ratio, quick ratio, and short interest as a percentage of float.</p>
            <p><strong>News:</strong> Recent headlines related to the company with AI-generated summaries.</p>
            <p><strong>Peer Comparison:</strong> Industry peers ranked by market cap, showing key metrics for side-by-side comparison. Loads asynchronously as it takes 15-20 seconds to gather data.</p>
        </div>
    </section>

    <!-- Financial Glossary -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">Financial Glossary</h2>
        </div>
        <div class="px-5 py-4">
            <dl class="space-y-4 text-sm">
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">P/E Ratio (Price-to-Earnings)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Stock price divided by earnings per share. A high P/E may indicate high growth expectations; a low P/E may suggest undervaluation or slower growth.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Market Cap (Market Capitalization)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Total market value of a company's outstanding shares. Calculated as share price times total shares outstanding.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Gross Margin</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Revenue minus cost of goods sold, divided by revenue. Shows how efficiently a company produces its goods or services.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">ROE (Return on Equity)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Net income divided by shareholders' equity. Measures how effectively the company uses equity to generate profit.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Debt-to-Equity Ratio</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Total debt divided by shareholders' equity. Indicates the proportion of financing from debt vs. equity. Higher ratios mean more leverage.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Current Ratio</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Current assets divided by current liabilities. Measures ability to pay short-term obligations. Above 1.0 is generally healthy.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Quick Ratio</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Like the current ratio but excludes inventory. A stricter test of short-term liquidity.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Short Float (%)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Percentage of available shares being sold short. High short interest may indicate bearish sentiment or potential for a short squeeze.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">QoQ (Quarter-over-Quarter)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Percentage change from one fiscal quarter to the next. Used to track short-term growth or decline.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">TTM (Trailing Twelve Months)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Data from the most recent 12-month period. Provides a current annual snapshot without waiting for fiscal year-end.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">EPS (Earnings Per Share)</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Net income divided by outstanding shares. Shows how much profit is attributable to each share of stock.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Beta</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Measure of a stock's volatility relative to the overall market. Beta &gt; 1 means more volatile than the market; &lt; 1 means less volatile.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">Dividend Yield</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">Annual dividend per share divided by the stock price. Shows the return from dividends alone.</dd>
                </div>
                <div>
                    <dt class="font-bold text-brand dark:text-blue-300">52-Week Range</dt>
                    <dd class="text-gray-600 dark:text-gray-400 ml-4">The lowest and highest prices at which a stock has traded during the past 52 weeks (one year).</dd>
                </div>
            </dl>
        </div>
    </section>

    <!-- About AI Commentary -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">About AI Commentary</h2>
        </div>
        <div class="px-5 py-4 text-gray-700 dark:text-gray-300 text-sm leading-relaxed space-y-2">
            <p>The Outlook section on each dashboard is generated by <strong>Claude</strong> (Anthropic's AI assistant). It analyzes the financial data and recent news to provide a concise 5-sentence assessment covering company health, price outlook, risks, recent developments, and industry context.</p>
            <p>If the AI service is unavailable, a rule-based fallback generates the commentary using the same financial data.</p>
            <p class="text-red-700 dark:text-red-400 font-semibold">This is not investment advice. AI-generated commentary is for informational purposes only. Always consult a qualified financial advisor before making investment decisions.</p>
        </div>
    </section>

    <!-- Data Sources -->
    <section class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6 overflow-hidden">
        <div class="bg-brand text-white px-5 py-3">
            <h2 class="font-bold text-sm uppercase tracking-wide">Data Sources</h2>
        </div>
        <div class="px-5 py-4 text-gray-700 dark:text-gray-300 text-sm leading-relaxed space-y-2">
            <p><strong>Yahoo Finance</strong> — All financial data, stock prices, analyst estimates, and news headlines are sourced from Yahoo Finance via the yfinance library.</p>
            <p><strong>Data may be delayed up to 15 minutes.</strong> Real-time quotes are not guaranteed. Prices shown are indicative and may differ from live exchange prices.</p>
            <p><strong>Claude AI (Anthropic)</strong> — AI commentary and news summaries are generated using Claude Haiku.</p>
        </div>
    </section>
</div>
{% endblock %}
